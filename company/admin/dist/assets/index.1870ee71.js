import{K as e,i as t}from"./element-plus.1a8f7ccb.js";import{k as l,d as n,f as a,o,c as i,W as s,U as r,a as p,Z as c,R as u,a8 as d}from"./@vue.df4a0536.js";import"./@vueuse.ca8459fe.js";import"./@element-plus.5fd8ebeb.js";import"./lodash-es.503fa2cd.js";import"./dayjs.6e4093f3.js";import"./axios.68af02ab.js";import"./async-validator.fb49d0f5.js";import"./@ctrl.82a509e0.js";import"./@popperjs.36402333.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";const m=d("搜索周边"),g=d("到这去-步行"),v=d("到这去-骑行"),f=d("到这去-公交"),h=d("到这去-驾车"),w=l({__name:"index",props:{lng:null,lat:null,width:{default:"650px"},height:{default:"650px"}},emits:["getMapInfo"],setup(l,{emit:d}){const w=l,y=n();let j;const C=n(),k=n(),b=window.BMap,O=n({lng:116.404,lat:39.915});a((async()=>{k.value={point:{lng:w.lng,lat:w.lat},address:""},S().then((e=>{k.value=e,_()})).catch((e=>{_()}))}));const S=()=>new Promise(((e,t)=>{const l=new b.Geolocation({maximumAge:10});l.enableSDKLocation(),l.getCurrentPosition((n=>{if(0==l.getStatus()){(new b.Geocoder).getLocation(n.point,(t=>{var l,a;n.point.lng=null!=(l=w.lng)?l:n.point.lng,n.point.lat=null!=(a=w.lat)?a:n.point.lat,e({point:n.point,address:t.address})}))}else t(l.getStatus())}))})),_=()=>{j=new b.Map(y.value);const{lng:e,lat:t}=k.value.point;let l=new b.Point(e,t);j.centerAndZoom(l,15),j.enableScrollWheelZoom(!0),L(e,t);const n=new b.ScaleControl;j.addControl(n);const a=new b.CityListControl;j.addControl(a),j.addEventListener("click",(e=>{const{lng:t,lat:l}=e.point;L(t,l,!0),O.value=e.point}))},R=e=>{j.clearOverlays(),j.centerAndZoom(e.point,15),L(e.point.lng,e.point.lat),O.value=e.point,d("getMapInfo",e)},x=(e,t)=>{let l=new b.LocalSearch(j,{onSearchComplete:()=>{var e;const n=(null==(e=l.getResults())?void 0:e.Ir)||[];t(n)}});l.search(e)},M=()=>{j.clearOverlays();const{lng:e,lat:t}=k.value.point;let l=new b.Point(e,t);var n=new b.Circle(l,1e3,{fillColor:"blue",strokeWeight:1,fillOpacity:.3,strokeOpacity:.3});j.addOverlay(n),new b.LocalSearch(j,{renderOptions:{map:j,autoViewport:!1}}).searchNearby(C.value,l,1e3)},P=e=>{j.clearOverlays();let t=new b[e](j,{onSearchComplete:()=>{t.getResults()},renderOptions:{map:j,autoViewport:!0}});const{lng:l,lat:n}=k.value.point,{lng:a,lat:o}=O.value;let i=new b.Point(l,n),s=new b.Point(a,o);t.search(i,s)},L=(e,t,l=!1)=>{l&&(j.clearOverlays(),L(k.value.point.lng,k.value.point.lat));const n=new b.Point(e,t),a=new b.Marker(n);j.addOverlay(a),a.setAnimation(2),a.enableDragging()};return(l,n)=>{const a=e,d=t;return o(),i(u,null,[s(a,{modelValue:C.value,"onUpdate:modelValue":n[0]||(n[0]=e=>C.value=e),"value-key":"title",placeholder:"请输入地址","fetch-suggestions":x,onSelect:R},null,8,["modelValue"]),s(d,{onClick:M},{default:r((()=>[m])),_:1}),s(d,{onClick:n[1]||(n[1]=e=>P("WalkingRoute"))},{default:r((()=>[g])),_:1}),s(d,{onClick:n[2]||(n[2]=e=>P("RidingRoute"))},{default:r((()=>[v])),_:1}),s(d,{onClick:n[3]||(n[3]=e=>P("TransitRoute"))},{default:r((()=>[f])),_:1}),s(d,{onClick:n[4]||(n[4]=e=>P("DrivingRoute"))},{default:r((()=>[h])),_:1}),p("div",{ref_key:"GMapRef",ref:y,style:c({width:w.width,height:w.height})},null,4)],64)}}}),y=p("h2",null,"地图",-1),j=l({__name:"index",setup(e){const t=e=>{};return(e,l)=>{const n=w;return o(),i("div",null,[y,s(n,{onGetMapInfo:t})])}}});export{j as default};
