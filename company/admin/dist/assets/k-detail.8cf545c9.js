import"./requestEachrts.b22f277c.js";import{d as e}from"./dayjs.6e4093f3.js";import"./axios.68af02ab.js";import{e as a,f as t,_ as s}from"./index.f5ed39b5.js";import{r as i}from"./index.b0f22997.js";import{k as o,d as r,e as l,n,o as d,c as u,a as c,R as m,a7 as p,S as h,Y as f,Z as v,W as y,U as b,T as x}from"./@vue.df4a0536.js";import{e as g}from"./echarts.f2c327c9.js";import{u as j,v as k}from"./element-plus.1a8f7ccb.js";import{u as w}from"./vue-router.3b0bf160.js";import"./pinia.447e158a.js";import"./@vueuse.ca8459fe.js";import"./@element-plus.5fd8ebeb.js";import"./nprogress.058bccf8.js";import"./pako.fc44881c.js";import"./mitt.550594b0.js";import"./ws.f1fd17a3.js";import"./lodash-es.503fa2cd.js";import"./async-validator.fb49d0f5.js";import"./@ctrl.82a509e0.js";import"./@popperjs.36402333.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./zrender.96458137.js";import"./tslib.60310f1a.js";const S={class:"switch-list"},M=["onClick"],A=s(o({__name:"echart-k",props:{width:{default:"800px"},height:{default:"500px"},currency:{default:"btcusdt"}},setup(s){const o=s,y=a(),b=r();let x,j,k;const w=r(["1min","5min","15min","30min","60min","4hour","1day","1mon","1week","1year"]),A=r([]),D=r("1min"),L=r("1min");l((()=>o.currency),((e,a)=>{a&&_(a),e&&n((()=>{I()}))}),{immediate:!0});const I=()=>{(function(e){return i({baseUrl:"/huobi-api",method:"get",url:"/market/history/kline",params:e})})({symbol:o.currency,period:D.value,size:2e3}).then((e=>{A.value=(e.data||[]).sort(((e,a)=>e.id-a.id)),n((()=>{x=g.init(b.value,"dark"),j="#00c087",k="#ff7858",z(),_(),O()}))}))};t((()=>{_()}));const O=()=>{y.send(`market.${o.currency}.kline.${D.value}`,o.currency,(e=>{if(e.tick){const a=A.value.findIndex((a=>a.id===e.tick.id));-1===a?A.value.push(e.tick):A.value.splice(a,1,e.tick),C()}}))},_=(e=o.currency)=>{y.unSend(`market.${e}.kline.${L.value}`,o.currency)},z=()=>{var a=N(JSON.parse(JSON.stringify(A.value)));x.setOption({animation:!1,legend:{bottom:30,left:"center",data:["蜡烛图","MA5","MA10","MA20","MA30"]},tooltip:{trigger:"axis",axisPointer:{type:"cross"},borderWidth:1,borderColor:"#ccc",padding:10,textStyle:{color:"#000"},position:function(e,a,t,s,i){const o={top:10};return o[["left","right"][+(e[0]<i.viewSize[0]/2)]]=30,o}},axisPointer:{link:[{xAxisIndex:"all"}],label:{backgroundColor:"#777"}},visualMap:{show:!1,seriesIndex:5,dimension:2,pieces:[{value:1,color:k},{value:-1,color:j}]},grid:[{left:"5%",right:"10%",height:"50%"},{left:"5%",right:"10%",top:"63%",height:"16%"}],xAxis:[{axisLabel:{formatter:function(a){return e(a).format("MM-DD HH:mm")}},type:"category",data:a.categoryData,boundaryGap:!1,axisLine:{onZero:!1},splitLine:{show:!1},min:"dataMin",max:"dataMax",axisPointer:{z:100}},{type:"category",gridIndex:1,data:a.categoryData,boundaryGap:!1,axisLine:{onZero:!1},axisTick:{show:!1},splitLine:{show:!1},axisLabel:{show:!1},min:"dataMin",max:"dataMax"}],yAxis:[{position:"right",scale:!0,splitArea:{show:!0}},{scale:!0,gridIndex:1,splitNumber:2,axisLabel:{show:!1},axisLine:{show:!1},axisTick:{show:!1},splitLine:{show:!1}}],dataZoom:[{type:"inside",xAxisIndex:[0,1],start:98,end:100}],series:[{name:"蜡烛图",type:"candlestick",data:a.values,itemStyle:{color:j,color0:k,borderColor:void 0,borderColor0:void 0},tooltip:{formatter:function(e){return["Date: "+(e=e[0]).name+'<hr size=1 style="margin: 3px 0">',"Open: "+e.data[0]+"<br/>","Close: "+e.data[1]+"<br/>","Lowest: "+e.data[2]+"<br/>","Highest: "+e.data[3]+"<br/>"].join("")}}},{name:"MA5",type:"line",data:J(5,a),smooth:!0,showSymbol:!1,lineStyle:{opacity:.5}},{name:"MA10",type:"line",data:J(10,a),smooth:!0,showSymbol:!1,lineStyle:{opacity:.5}},{name:"MA20",type:"line",data:J(20,a),smooth:!0,showSymbol:!1,lineStyle:{opacity:.5}},{name:"MA30",type:"line",data:J(30,a),smooth:!0,showSymbol:!1,lineStyle:{opacity:.5}},{name:"Volume",type:"bar",xAxisIndex:1,yAxisIndex:1,data:a.volumes}]})},C=()=>{var e=N(JSON.parse(JSON.stringify(A.value)));x.setOption({xAxis:[{data:e.categoryData},{data:e.categoryData}],series:[{data:e.values},{data:J(5,e)},{data:J(10,e)},{data:J(20,e)},{data:J(30,e)},{data:e.volumes}]})};function N(a){let t=[],s=[],i=[];for(let o=0;o<a.length;o++){const r=a[o],l=e(1e3*r.id).format("YYYY-MM-DD HH:mm:ss");t.push(l),s.push([r.open,r.close,r.low,r.high,r.id]),i.push([o,r.close,r.open>r.close?1:-1])}return{categoryData:t,values:s,volumes:i}}function J(e,a){for(var t=[],s=0,i=a.values.length;s<i;s++)if(s<e)t.push("-");else{for(var o=0,r=0;r<e;r++)o+=a.values[s-r][1];t.push(+(o/e).toFixed(3))}return t}return(e,a)=>(d(),u(m,null,[c("div",S,[(d(!0),u(m,null,p(w.value,(e=>(d(),u("div",{key:e,class:h({"switch-item":!0,active:e===D.value}),onClick:a=>{return t=e,void(D.value!==t&&(L.value=JSON.parse(JSON.stringify(D.value)),D.value=t,I()));var t}},f(e),11,M)))),128))]),c("div",{ref_key:"echartsDom",ref:b,style:v(`width: ${o.width};height: ${o.height};`)},null,4)],64))}}),[["__scopeId","data-v-b694d266"]]),D=o({__name:"k-detail",setup(e){const a=w(),t=r([]),s=r("btcusdt");a.params.id&&(s.value=a.params.id);var o;return i({baseUrl:"/huobi-api",method:"get",url:"/v2/settings/common/symbols",params:{ts:o}}).then((e=>{t.value=e.data||[],t.value=t.value.filter((e=>"online"===e.state))})),(e,a)=>{const i=j,o=k,r=A;return d(),u("div",null,[c("h2",null,"k线图-"+f(s.value)+"/echarts-kline",1),y(o,{filterable:"",modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),placeholder:"输入币种名称"},{default:b((()=>[(d(!0),u(m,null,p(t.value,(e=>(d(),x(i,{key:e.sc,label:e.sc,value:e.sc},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),y(r,{currency:s.value},null,8,["currency"])])}}});export{D as default};
