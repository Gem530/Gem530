var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(t,i,o)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[i]=o,h=(e,t)=>{for(var i in t||(t={}))a.call(t,i)&&r(e,i,t[i]);if(o)for(var i of o(t))n.call(t,i)&&r(e,i,t[i]);return e},l=(e,o)=>t(e,i(o));import{d as s,a as d,r as c,l as g,Q as p,o as u,e as w,B as m,C as v,u as f,m as b,x as D,J as y,E as W,G as P,D as U,n as j,f as x,A as O}from"./@vue.0069b3ae.js";import{_ as B}from"./plugin-vue_export-helper.21dcd24c.js";const H=e=>(W("data-v-c0ac1862"),e=e(),P(),e),M={class:"photo-overflow"},E=["width"],F=H((()=>b("span",null,"未获取到取景框拍照权限",-1))),I=H((()=>b("span",null,"请点击右上角刷新后授权，或者",-1))),R=U(" 直接手机拍照 "),k=H((()=>b("button",{style:{position:"absolute",top:"0px",left:"0px"}},"拍照",-1)));var A=B(s(l(h({},{name:"g-find-frame"}),{props:{width:{default:350},height:{default:200}},emits:["getPhotoBlob"],setup(e,{emit:t}){const i=e,o=d(),a=d(),n=c({flag:!0,imgNewURL:"",widthD:0,heightD:0,clientWidthD:0,clientHeightD:0,photoW:0,photoH:0,photoFlag:!0});g((()=>{navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)?n.flag=!0:n.flag=!1})),p((()=>{j((()=>{r()}))}));const r=()=>{n.clientWidthD=document.body.clientWidth,n.clientHeightD=document.body.clientHeight,i.width?(n.widthD=i.width,n.clientWidthD=i.width):n.widthD=n.clientWidthD,i.height?(n.heightD=i.height,n.clientHeightD=i.height):n.heightD=n.clientHeightD;const e=navigator;void 0===e.mediaDevices&&(e.mediaDevices={}),void 0===e.mediaDevices.getUserMedia&&(e.mediaDevices.getUserMedia=function(t){const i=e.webkitGetUserMedia||e.mozGetUserMedia;return i?new Promise((function(o,a){i.call(e,t,o,a)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),e.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then((function(e){"srcObject"in o.value?o.value.srcObject=e:o.value.src=window.URL.createObjectURL(e),o.value.onloadedmetadata=function(){o.value.play()},j((()=>{o.value.addEventListener("canplay",(()=>{n.photoW=o.value.videoWidth,n.photoH=o.value.videoHeight,n.widthD>n.photoW&&(n.widthD=n.photoW),n.heightD>n.photoH&&(n.heightD=n.photoH*n.widthD/n.photoW)}))}))})).catch((function(e){n.photoFlag=!1}))},h=async()=>{if(!n.photoFlag)return void a.value.click();const e=document.createElement("canvas"),i=e.getContext("2d");n.flag?(e.width=2*n.widthD,e.height=2*n.heightD):(e.width=n.widthD,e.height=n.heightD),i.drawImage(o.value,0,0,n.photoW,n.photoW*(n.heightD/n.widthD),0,0,e.width,e.height);const r=e.toDataURL("image/jpeg",1),h=await P(r);t("getPhotoBlob",{blob:h,baseUrl:r})},l=async()=>{const e=document.getElementById("ground-push-image").files[0],i=await s(e),o=await W(i);t("getPhotoBlob",{blob:o,baseUrl:i.src})},s=e=>new Promise(((t,i)=>{const o=new Image,a=new FileReader;a.onload=function(e){o.src=e.target.result},a.onerror=function(e){i(e)},a.readAsDataURL(e),o.onload=function(){t(o)},o.onerror=function(e){i(e)}})),W=(e,t=.13)=>new Promise((async(i,o)=>{try{const o=document.createElement("canvas"),a=o.getContext("2d"),{width:n,height:r}=e;o.width=n,o.height=r,a.clearRect(0,0,n,r),a.drawImage(e,0,0,n,r);const h=o.toDataURL("image/jpeg",t);i(await P(h))}catch(a){o(a)}})),P=e=>{const t=window.atob(e.split(",")[1]),i=new ArrayBuffer(t.length),o=new Uint8Array(i);for(let a=0;a<t.length;a++)o[a]=t.charCodeAt(a);return new Blob([i],{type:"image/jpeg"})};return(e,t)=>(u(),w("div",{class:"component theme",style:D(`width: ${f(n).clientWidthD}px;height: ${f(n).heightD}px;`)},[m(b("div",M,[b("video",{class:"video-contain",ref_key:"video",ref:o,id:"video",width:f(n).clientWidthD,autoplay:"",playsinline:"","webkit-playsinline":"true",muted:""},null,8,E)],512),[[v,f(n).photoFlag]]),m(b("div",{class:"error",style:D(`width: ${f(n).clientWidthD}px;height: ${f(n).heightD}px;`)},[F,I,b("button",null,[R,b("input",{type:"file",ref_key:"qrcodeImageDom",ref:a,id:"ground-push-image",onChange:l,accept:"image/*",capture:""},null,544)])],4),[[v,!f(n).photoFlag]]),b("div",{class:"btn-photo",onClick:h},[y(e.$slots,"default",{},(()=>[k]),!0)])],4))}})),[["__scopeId","data-v-c0ac1862"]]);const C={class:"contanir theme"},L=b("button",{style:{width:"100px",height:"30px","text-align":"center","line-height":"30px",color:"red"}},"拍-拍-照",-1),_=["src"],G=s(l(h({},{name:"findFrame"}),{setup(e){const t=d("");g((()=>{}));const i=e=>{t.value=e.baseUrl};return(e,o)=>(u(),w("div",C,[x(A,{width:500,height:300,onGetPhotoBlob:i},{default:O((()=>[L])),_:1}),b("img",{src:t.value,alt:""},null,8,_)]))}}));export{G as default};
