var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(s,t,a)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,d=(e,s)=>{for(var t in s||(s={}))r.call(s,t)&&n(e,t,s[t]);if(a)for(var t of a(s))o.call(s,t)&&n(e,t,s[t]);return e},c=(e,a)=>s(e,t(a));import{_ as i}from"./avator.a76dfba7.js";import{u as l}from"./vuex.cf57797f.js";import{s as m}from"./index.50dc0881.js";import{n as g,d as v,a as u,r as p,l as f,o as h,e as I,m as y,B as b,O as _,u as x,J as j,E as w,G as O,D as k,f as R,A as D,F as S,v as E,y as P,z as H}from"./@vue.0069b3ae.js";import{u as T,b as M}from"./vue-router.8c9b9931.js";import{_ as $}from"./plugin-vue_export-helper.21dcd24c.js";import{G as z}from"./index.8fdb8f0c.js";import{s as C,e as F,f as G}from"./index.b27fe81c.js";import"./vuex-persistedstate.fa252374.js";import"./axios.e7b69eb3.js";const J={class:"component theme"},A={class:"send"},B={class:"bottom-box"};var L=$(v(c(d({},{name:"send"}),{emits:["send"],setup(e,{emit:s}){T();const t=u(),a=u(),r=p({message:""});f((()=>{}));const o=()=>{s("send",r.message),r.message=""},n=()=>{a.value.style.height="auto";let e=a.value.scrollHeight;e=Math.min(e,100),e&&(a.value.style.height=e+"px",t.value.style.height=e+"px")};return(e,s)=>(h(),I("div",J,[y("div",A,[b(y("textarea",{class:"send-textarea",rows:"1","onUpdate:modelValue":s[0]||(s[0]=e=>x(r).message=e),onInput:n,ref_key:"textareaRef",ref:a},null,544),[[_,x(r).message]]),y("div",{class:"send-btn",onClick:o},"发送")]),y("div",B,[y("div",{ref_key:"bottomRef",ref:t},null,512)])]))}})),[["__scopeId","data-v-45b721be"]]);const N=e=>(w("data-v-0f11a93f"),e=e(),O(),e),U={class:"component theme"},V={class:"header"},W=k("标题"),Y=k("icon"),q=N((()=>y("div",{style:{height:"45px"}},null,-1)));var K=$(v(c(d({},{name:"Headers"}),{setup(e){const s=T();return f((()=>{})),(e,t)=>(h(),I("div",U,[y("div",V,[y("i",{class:"iconfont icon-arrow-left-bold",onClick:t[0]||(t[0]=e=>x(s).go(-1))}),y("div",null,[j(e.$slots,"title",{},(()=>[W]),!0)]),y("div",null,[j(e.$slots,"right",{},(()=>[Y]),!0)])]),q]))}})),[["__scopeId","data-v-0f11a93f"]]);const Q=k("聊天室"),X={class:"main"},Z=["src"],ee={key:1,class:"message-avator",src:i},se={class:"message-info"},te={class:"message-name"},ae={class:"message-time"},re={class:"message-box"};var oe=$(v(c(d({},{name:"r-chatRoom"}),{setup(e){const s=l();M(),T();const t=u(),a=p({Id:0,recvId:0,list:[]});a.Id=s.getters.user.userId,a.recvId=s.getters.chatRoom.Id,f((()=>{}));window.addEventListener("onmessageWS",(({detail:e})=>{const s=JSON.parse(e.data);(s.send_id===a.Id&&s.recv_id===a.recvId||s.send_id===a.recvId&&s.recv_id===a.Id)&&a.list.push(s)}));const r=e=>{const t={msg:e,sendId:a.Id,recvId:a.recvId};C(t).then((t=>{const a={msg:e,send_id:s.getters.user.userId,send_name:s.getters.user.name,createTime:new Date,recv_id:s.getters.chatRoom.Id,recv_name:s.getters.chatRoom.name,avator:s.getters.user.avator};m(a)})).catch((e=>{z({message:"消息发送失败："+e.message,type:"error",duration:1500})}))};(()=>{const e={sendId:a.recvId,recvId:a.Id};F(e).then((e=>{})).catch((e=>{z({message:"更新消息状态失败："+e.message,type:"error",duration:1500})}))})();(e=>{const s={page:1,sendId:a.Id,recvId:a.recvId,pageSize:10};G(s).then((e=>{var s,r;a.list=e.data,s=t.value,r=t.value.scrollHeight,g((()=>{s.scrollTop=r}))})).catch((e=>{z({message:"获取与好友的聊天记录失败："+e.message,type:"error",duration:1500})}))})();const o=(e,s)=>function(e,s){if(0===arguments.length||!e)return null;const t=s||"{y}-{m}-{d} {h}:{i}:{s}";let a;"object"==typeof e?a=e:("string"==typeof e&&/^[0-9]+$/.test(e)?e=parseInt(e):"string"==typeof e&&(e=e.replace(new RegExp(/-/gm),"/").replace("T"," ").replace(new RegExp(/\.[\d]{3}/gm),"")),"number"==typeof e&&10===e.toString().length&&(e*=1e3),a=new Date(e));const r={y:a.getFullYear(),m:a.getMonth()+1,d:a.getDate(),h:a.getHours(),i:a.getMinutes(),s:a.getSeconds(),a:a.getDay()};return t.replace(/{(y|m|d|h|i|s|a)+}/g,((e,s)=>{let t=r[s];return"a"===s?["日","一","二","三","四","五","六"][t]:(e.length>0&&t<10&&(t="0"+t),t||0)}))}(e,s),n=e=>e===s.getters.user.userId;return(e,s)=>(h(),I("div",{class:"contanir theme",ref_key:"mainDom",ref:t},[R(K,null,{title:D((()=>[Q])),_:1}),y("main",X,[(h(!0),I(S,null,E(x(a).list,(e=>(h(),I("div",{class:P({"message-item":!0,right:n(e.send_id)}),key:e.Id},[e.avator?(h(),I("img",{key:0,class:"message-avator",src:e.avator},null,8,Z)):(h(),I("img",ee)),y("div",se,[y("div",te,H(n(e.send_id)?e.send_name:e.recv_name),1),y("div",ae,H(o(e.createTime,"{y}-{m}-{d} {h}:{i}:{s}")),1),y("div",re,H(e.msg),1)])],2)))),128))]),R(L,{onSend:r})],512))}})),[["__scopeId","data-v-ed670f3a"]]);export{oe as default};
