var P=Object.defineProperty,q=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var $=(i,o,e)=>o in i?P(i,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[o]=e,U=(i,o)=>{for(var e in o||(o={}))K.call(o,e)&&$(i,e,o[e]);if(H)for(var e of H(o))Q.call(o,e)&&$(i,e,o[e]);return i},F=(i,o)=>q(i,J(o));import{d as W,a as r,l as D,o as V,e as E,m as u,B as Z,O as ee,x as te,D as G,f as ae}from"./@vue.fb42abb7.js";import{f as d}from"./fabric.310a32ce.js";import{_ as le}from"./plugin-vue_export-helper.21dcd24c.js";import"./axios.e7b69eb3.js";var ne="./assets/login.8a45a3bc.jpeg";const oe=["width","height"],ie=["src"],se={class:"flex"},ue={class:"upload-btn"},ce=G("\u4E0A\u4F20\u5934\u50CF "),re=["min","max","step"],de=W({props:{width:{type:Number,default:300},height:{type:Number,default:300},x:{type:Number,default:150},y:{type:Number,default:150},clipWidth:{type:Number,default:100},clipHeight:{type:Number,default:100},maskColor:{type:String,default:"rgba(0, 0, 0, 0.5)"},minScale:{type:Number,default:.01},maxScale:{type:Number,default:3},scaleStep:{type:Number,default:.01},rotate:{type:Number,default:90}},emits:["getImg"],setup(i,{emit:o}){const e=i,C=r(),L=r(),n=r(null),m=r(null),h=r(void 0),w=r(ne),s=r(1),f=r(0),c=e.width,g=e.height,b=e.maskColor,p=e.y-e.clipHeight/2,x=e.x-e.clipWidth/2,I=e.x+e.clipWidth/2,_=e.y+e.clipHeight/2;D(()=>{M()});const M=async()=>{const a=new d.fabric.Canvas("canvas",{width:c,height:g,preserveObjectStacking:!0}),t=await X();k(),a.add(t);const l=new d.fabric.Group([new d.fabric.Rect({width:c,height:p+.08,fill:b,top:0,left:0}),new d.fabric.Rect({width:c-I,height:_-p,fill:b,top:p,left:I}),new d.fabric.Rect({width:c,height:g-_,fill:b,top:_-.06,left:0}),new d.fabric.Rect({width:x,height:_-p,fill:b,top:p,left:0})]);l.evented=!1,l.selectable=!1,a.add(l),a.renderAll(),m.value=a,Y()},k=()=>{n.value.top=g/2,n.value.left=c/2,n.value.originX="center",n.value.originY="center",n.value.cornerStyle="circle",n.value.rotate(0)},N=()=>{const a=n.value.width>c?c/n.value.width:n.value.width/c,t=n.value.height>g?g/n.value.height:n.value.height/c,l=a<=t?a:t;n.value.scaleX=l,n.value.scaleY=l,s.value=l},X=()=>new Promise((a,t)=>{d.fabric.Image.fromURL(w.value,l=>{n.value=l,N(),a(l)},{crossOrigin:"anonymous"})}),S=(a,t)=>{a==="-"?s.value-=e.scaleStep:a==="+"&&(s.value+=e.scaleStep),B()},A=a=>{a==="right"?f.value+=e.rotate:f.value-=e.rotate,n.value.rotate(f),m.value.renderAll()},Y=()=>{m.value.on("mouse:wheel",function({e:a}){s.value=(a.deltaY>0?-e.scaleStep:e.scaleStep)+n.value.scaleX,B()})},B=()=>{s.value=Math.max(e.minScale,s.value),s.value=Math.min(e.maxScale,s.value),n.value.scaleX=s.value,n.value.scaleY=s.value,m.value.renderAll()},j=({target:a})=>{let t=new FileReader;t.readAsDataURL(a.files[0]),t.onload=function(l){f.value=0,h.value=void 0,w.value=l.target.result,n.value.setSrc(w.value,v=>{n.value=v,k(),N(),m.value.renderAll()})}},O=(a,t,l=1,v="png")=>m.value.toDataURL({top:p,left:x,width:a,height:t,format:v,quality:l}),T=()=>{h.value=O(e.clipWidth,e.clipHeight);const a=z(h.value);o("getImg",{url:h.value,blob:a})},z=a=>{for(var t=a.split(","),l=t[0].match(/:(.*?);/)[1],v=atob(t[1]),y=v.length,R=new Uint8Array(y);y--;)R[y]=v.charCodeAt(y);return new Blob([R],{type:l})};return(a,t)=>(V(),E("div",{class:"component theme",style:te(`width: ${e.width}px;`)},[u("canvas",{id:"canvas",ref_key:"myCanvas",ref:C,width:e.width,height:e.height},null,8,oe),u("img",{src:h.value,alt:""},null,8,ie),u("div",se,[u("button",ue,[ce,u("input",{type:"file",accept:"image/*",ref_key:"uploadInput",ref:L,class:"upload-file-input",onChange:j},null,544)]),u("button",{onClick:t[0]||(t[0]=l=>S("-"))},"-"),Z(u("input",{type:"range","onUpdate:modelValue":t[1]||(t[1]=l=>s.value=l),min:e.minScale,max:e.maxScale,step:e.scaleStep,onInput:t[2]||(t[2]=l=>S("change"))},null,40,re),[[ee,s.value]]),u("button",{onClick:t[3]||(t[3]=l=>S("+"))},"+"),u("button",{onClick:t[4]||(t[4]=l=>A("right"))},"\u53F3\u65CB\u8F6C"),u("button",{onClick:t[5]||(t[5]=l=>A("left"))},"\u5DE6\u65CB\u8F6C"),u("button",{onClick:T},"\u88C1\u526A")])],4))}});var me=le(de,[["__scopeId","data-v-5932450a"]]);const pe={class:"contanir component theme"},ve=G(" \u56FE\u7247\u88C1\u526A\u9875\u9762 "),he={name:"clip-img"},we=W(F(U({},he),{setup(i){D(()=>{});const o=e=>{console.log(e)};return(e,C)=>(V(),E("div",pe,[ve,ae(me,{x:150,y:150,width:300,rotate:90,height:300,maxScale:3,minScale:.01,clipWidth:80,clipHeight:80,scaleStep:.01,maskColor:"rgba(0, 0, 0, 0.5)",onGetImg:o},null,8,["minScale","scaleStep"])]))}}));export{we as default};
