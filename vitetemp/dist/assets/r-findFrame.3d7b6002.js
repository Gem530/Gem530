var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,s=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&r(e,a,t[a]);if(i)for(var a of i(t))n.call(t,a)&&r(e,a,t[a]);return e},h=(e,i)=>t(e,a(i));import{d as l,a as d,r as c,l as g,Q as p,T as u,o as m,e as w,B as v,C as f,u as b,m as D,x as y,M as P,J as B,E as j,G as k,D as O,n as x,f as U,A as W,z as C}from"./@vue.17df1b64.js";import"./tracking.51ddc836.js";import{_ as M}from"./plugin-vue_export-helper.21dcd24c.js";const E=e=>(j("data-v-187e99af"),e=e(),k(),e),I={class:"photo-overflow"},S=["width","height"],R=E((()=>D("span",null,"未获取到取景框拍照权限",-1))),A=E((()=>D("span",null,"请点击右上角刷新后授权，或者",-1))),F=O(" 直接手机拍照 "),H=["width","height"],L=E((()=>D("button",{style:{position:"absolute",top:"0px",left:"0px"}},"拍照",-1)));var _=M(l(h(s({},{name:"g-find-frame"}),{props:{width:{default:350},height:{default:200}},emits:["getPhotoBlob"],setup(e,{emit:t}){const a=e,i=d(),o=d(),n=d(),r=c({flag:!0,imgNewURL:"",widthD:0,heightD:0,clientWidthD:0,clientHeightD:0,photoW:0,photoH:0,photoFlag:!0}),s=window;g((()=>{navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)?r.flag=!0:r.flag=!1})),p((()=>{x((()=>{k("environment")}))})),u((()=>{j()}));const h=e=>{l(),k(e)},l=()=>i.value.srcObject&&i.value.srcObject.getTracks().map((e=>e.stop())),j=()=>{n.value.stop(),n.value.closeCamera()},k=e=>{r.widthD=a.width,r.heightD=a.height,r.clientWidthD=a.width,r.clientHeightD=a.height;const t=navigator;void 0===t.mediaDevices&&(t.mediaDevices={}),void 0===t.mediaDevices.getUserMedia&&(t.mediaDevices.getUserMedia=function(e){const a=t.webkitGetUserMedia||t.mozGetUserMedia;return a?new Promise((function(i,o){a.call(t,e,i,o)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),t.mediaDevices.getUserMedia({audio:!1,video:{width:a.width,height:a.height,facingMode:e}}).then((function(e){"srcObject"in i.value?i.value.srcObject=e:i.value.src=window.URL.createObjectURL(e),i.value.onloadedmetadata=function(){i.value.play()},x((()=>{i.value.addEventListener("canplay",(()=>{r.photoW=i.value.videoWidth,r.photoH=i.value.videoHeight,r.widthD>r.photoW&&(r.widthD=r.photoW),r.heightD>r.photoH&&(r.heightD=r.photoH*r.widthD/r.photoW)}))}))})).catch((function(e){r.photoFlag=!1}));const o=document.getElementById("tempCanvas"),h=document.getElementById("videoDom"),l=o.getContext("2d");let d=new s.tracking.ObjectTracker("face");d.setInitialScale(4),d.setStepSize(2),d.setEdgesDensity(.1),n.value=s.tracking.track("#videoDom",d,{camera:!0}),d.on("track",(e=>{l.clearRect(0,0,o.width,o.height),e.data.forEach((e=>{l.drawImage(h,0,0,o.width,o.height),l.font="16px Helvetica",l.strokeStyle="#1890ff",l.strokeRect(e.x,e.y,e.width,e.height)})),e.data.length}))},O=async()=>{if(!r.photoFlag)return void o.value.click();const e=document.createElement("canvas"),a=e.getContext("2d");r.flag,e.width=r.widthD,e.height=r.heightD,a.drawImage(i.value,0,0,r.photoW,r.photoW*(r.heightD/r.widthD),0,0,e.width,e.height);const n=e.toDataURL("image/jpeg",1),s=await M(n);t("getPhotoBlob",{blob:s,baseUrl:n})},U=async()=>{const e=document.getElementById("ground-push-image").files[0],a=await W(e),i=await C(a);t("getPhotoBlob",{blob:i,baseUrl:a.src})},W=e=>new Promise(((t,a)=>{const i=new Image,o=new FileReader;o.onload=function(e){i.src=e.target.result},o.onerror=function(e){a(e)},o.readAsDataURL(e),i.onload=function(){t(i)},i.onerror=function(e){a(e)}})),C=(e,t=.13)=>new Promise((async(a,i)=>{try{const i=document.createElement("canvas"),o=i.getContext("2d"),{width:n,height:r}=e;i.width=n,i.height=r,o.clearRect(0,0,n,r),o.drawImage(e,0,0,n,r);const s=i.toDataURL("image/jpeg",t);a(await M(s))}catch(o){i(o)}})),M=e=>{const t=window.atob(e.split(",")[1]),a=new ArrayBuffer(t.length),i=new Uint8Array(a);for(let o=0;o<t.length;o++)i[o]=t.charCodeAt(o);return new Blob([a],{type:"image/jpeg"})};return(e,t)=>(m(),w("div",{class:"component theme",style:y(`width: ${b(r).clientWidthD}px;height: ${b(r).heightD}px;`)},[v(D("div",I,[D("video",{class:"video-contain",ref_key:"video",ref:i,id:"videoDom",width:b(r).clientWidthD,height:b(r).heightD,autoplay:"",playsinline:"","webkit-playsinline":"true",muted:""},null,8,S)],512),[[f,b(r).photoFlag]]),v(D("div",{class:"error",style:y(`width: ${b(r).clientWidthD}px;height: ${b(r).heightD}px;`)},[R,A,D("button",null,[F,D("input",{type:"file",ref_key:"qrcodeImageDom",ref:o,id:"ground-push-image",onChange:U,accept:"image/*",capture:""},null,544)])],4),[[f,!b(r).photoFlag]]),D("canvas",{id:"tempCanvas",width:b(r).clientWidthD,height:b(r).heightD},null,8,H),D("div",{class:"btn-photo",onClick:O},[D("button",{onClick:t[0]||(t[0]=P((e=>h("user")),["stop"]))},"前置摄像头"),B(e.$slots,"default",{},(()=>[L]),!0),D("button",{onClick:t[1]||(t[1]=P((e=>h("environment")),["stop"]))},"后置摄像头")])],4))}})),[["__scopeId","data-v-187e99af"]]);const G={class:"contanir theme"},Q=D("button",{style:{width:"100px",height:"30px","text-align":"center","line-height":"30px",color:"red"}},"拍-拍-照",-1),$=["src"],z=l(h(s({},{name:"findFrame"}),{setup(e){const t=d(""),a=d(500),i=d(300);navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)?(a.value=300,i.value=500):(a.value=500,i.value=300),g((()=>{}));const o=e=>{t.value=e.baseUrl};return(e,n)=>(m(),w("div",G,[U(_,{width:a.value,height:i.value,onGetPhotoBlob:o},{default:W((()=>[Q])),_:1},8,["width","height"]),O(" "+C(a.value)+"/"+C(i.value)+" ",1),D("img",{src:t.value,alt:""},null,8,$)]))}}));export{z as default};
