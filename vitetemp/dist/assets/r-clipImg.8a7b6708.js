var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,u=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l;import{d as n,a as c,l as o,o as s,e as p,m as v,B as h,O as d,x as m,D as f,f as g}from"./@vue.0069b3ae.js";import{f as b}from"./fabric.310a32ce.js";import{_ as y}from"./plugin-vue_export-helper.21dcd24c.js";import"./axios.e7b69eb3.js";const w=["width","height"],S=["src"],x={class:"flex"},j={class:"upload-btn"},C=f("上传头像 "),O=["min","max","step"];var k=y(n({props:{width:{type:Number,default:300},height:{type:Number,default:300},x:{type:Number,default:150},y:{type:Number,default:150},clipWidth:{type:Number,default:100},clipHeight:{type:Number,default:100},maskColor:{type:String,default:"rgba(0, 0, 0, 0.5)"},minScale:{type:Number,default:.01},maxScale:{type:Number,default:3},scaleStep:{type:Number,default:.01},rotate:{type:Number,default:90}},emits:["getImg"],setup(e,{emit:t}){const a=e,l=c(),i=c(),r=c(null),u=c(null),n=c(void 0),f=c("./assets/login.8a45a3bc.jpeg"),g=c(1),y=c(0),k=a.width,N=a.height,I=a.maskColor,R=a.y-a.clipHeight/2,A=a.x-a.clipWidth/2,P=a.x+a.clipWidth/2,_=a.y+a.clipHeight/2;o((()=>{H()}));const H=async()=>{const e=new b.fabric.Canvas("canvas",{width:k,height:N,preserveObjectStacking:!0}),t=await D();U(),e.add(t);const a=new b.fabric.Group([new b.fabric.Rect({width:k,height:R+.08,fill:I,top:0,left:0}),new b.fabric.Rect({width:k-P,height:_-R,fill:I,top:R,left:P}),new b.fabric.Rect({width:k,height:N-_,fill:I,top:_-.06,left:0}),new b.fabric.Rect({width:A,height:_-R,fill:I,top:R,left:0})]);a.evented=!1,a.selectable=!1,e.add(a),e.renderAll(),u.value=e,L()},U=()=>{r.value.top=N/2,r.value.left=k/2,r.value.originX="center",r.value.originY="center",r.value.cornerStyle="circle",r.value.rotate(0)},W=()=>{const e=r.value.width>k?k/r.value.width:r.value.width/k,t=r.value.height>N?N/r.value.height:r.value.height/k,a=e<=t?e:t;r.value.scaleX=a,r.value.scaleY=a,g.value=a},D=()=>new Promise(((e,t)=>{b.fabric.Image.fromURL(f.value,(t=>{r.value=t,W(),e(t)}),{crossOrigin:"anonymous"})})),X=(e,t)=>{"-"===e?g.value-=a.scaleStep:"+"===e&&(g.value+=a.scaleStep),B()},Y=e=>{"right"===e?y.value+=a.rotate:y.value-=a.rotate,r.value.rotate(y),u.value.renderAll()},L=()=>{u.value.on("mouse:wheel",(function({e:e}){g.value=(e.deltaY>0?-a.scaleStep:a.scaleStep)+r.value.scaleX,B()}))},B=()=>{g.value=Math.max(a.minScale,g.value),g.value=Math.min(a.maxScale,g.value),r.value.scaleX=g.value,r.value.scaleY=g.value,u.value.renderAll()},G=({target:e})=>{let t=new FileReader;t.readAsDataURL(e.files[0]),t.onload=function(e){y.value=0,n.value=void 0,f.value=e.target.result,r.value.setSrc(f.value,(e=>{r.value=e,U(),W(),u.value.renderAll()}))}},M=()=>{n.value=((e,t,a=1,l="png")=>u.value.toDataURL({top:R,left:A,width:e,height:t,format:l,quality:a}))(a.clipWidth,a.clipHeight);const e=q(n.value);t("getImg",{url:n.value,blob:e})},q=e=>{for(var t=e.split(","),a=t[0].match(/:(.*?);/)[1],l=atob(t[1]),i=l.length,r=new Uint8Array(i);i--;)r[i]=l.charCodeAt(i);return new Blob([r],{type:a})};return(e,t)=>(s(),p("div",{class:"component theme",style:m(`width: ${a.width}px;`)},[v("canvas",{id:"canvas",ref_key:"myCanvas",ref:l,width:a.width,height:a.height},null,8,w),v("img",{src:n.value,alt:""},null,8,S),v("div",x,[v("button",j,[C,v("input",{type:"file",accept:"image/*",ref_key:"uploadInput",ref:i,class:"upload-file-input",onChange:G},null,544)]),v("button",{onClick:t[0]||(t[0]=e=>X("-"))},"-"),h(v("input",{type:"range","onUpdate:modelValue":t[1]||(t[1]=e=>g.value=e),min:a.minScale,max:a.maxScale,step:a.scaleStep,onInput:t[2]||(t[2]=e=>X("change"))},null,40,O),[[d,g.value]]),v("button",{onClick:t[3]||(t[3]=e=>X("+"))},"+"),v("button",{onClick:t[4]||(t[4]=e=>Y("right"))},"右旋转"),v("button",{onClick:t[5]||(t[5]=e=>Y("left"))},"左旋转"),v("button",{onClick:M},"裁剪")])],4))}}),[["__scopeId","data-v-5932450a"]]);const N={class:"contanir component theme"},I=f(" 图片裁剪页面 "),R=n((A=((e,t)=>{for(var a in t||(t={}))i.call(t,a)&&u(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&u(e,a,t[a]);return e})({},{name:"clip-img"}),t(A,a({setup(e){o((()=>{}));const t=e=>{};return(e,a)=>(s(),p("div",N,[I,g(k,{x:150,y:150,width:300,rotate:90,height:300,maxScale:3,minScale:.01,clipWidth:80,clipHeight:80,scaleStep:.01,maskColor:"rgba(0, 0, 0, 0.5)",onGetImg:t},null,8,["minScale","scaleStep"])]))}}))));var A;export{R as default};
